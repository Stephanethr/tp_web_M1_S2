<div class="versus-container">
    <h2>Versus Mode</h2>
  
    <div *ngIf="loading && !characters.length" class="text-center">
      <div class="spinner-border"></div>
      <p>Loading characters...</p>
    </div>
  
    <div *ngIf="error" class="alert alert-danger">
      {{ error }}
    </div>
  
    <div *ngIf="!showResult && characters.length > 0" class="fighters-selection">
      <div class="fighters-form">
        <div class="form-group">
          <label for="player1">Fighter 1</label>
          <select 
            id="player1" 
            [(ngModel)]="player1Id" 
            class="form-control" 
            [disabled]="loading">
            <option [ngValue]="null">Select character...</option>
            <option *ngFor="let char of characters" [value]="char.id">
              {{ char.name }} (Level {{ char.level }} {{ char.type === 'warrior' ? 'Warrior' : 'Mage' }})
            </option>
          </select>
        </div>
        
        <div class="versus-divider">VS</div>
        
        <div class="form-group">
          <label for="player2">Fighter 2</label>
          <select 
            id="player2" 
            [(ngModel)]="player2Id" 
            class="form-control" 
            [disabled]="loading">
            <option [ngValue]="null">Select character...</option>
            <option *ngFor="let char of characters" [value]="char.id">
              {{ char.name }} (Level {{ char.level }} {{ char.type === 'warrior' ? 'Warrior' : 'Mage' }})
            </option>
          </select>
        </div>
      </div>
      
      <div class="fighters-preview">
        <div class="fighter fighter-1" *ngIf="player1Id">
          <div class="character-avatar" 
               [ngClass]="(characters.find(c => c.id === player1Id)?.race.toLowerCase() || '') + '-' + 
                        (characters.find(c => c.id === player1Id)?.type || '')">
            <i class="fa" 
               [ngClass]="characters.find(c => c.id === player1Id)?.type === 'warrior' ? 'fa-shield-alt' : 'fa-hat-wizard'"></i>
          </div>
          <h3>{{ getCharacterName(player1Id) }}</h3>
        </div>
        
        <div class="fighter fighter-placeholder" *ngIf="!player1Id">
          <div class="character-avatar-placeholder">
            <i class="fa fa-question"></i>
          </div>
          <h3>Select Fighter 1</h3>
        </div>
        
        <div class="versus-icon">VS</div>
        
        <div class="fighter fighter-2" *ngIf="player2Id">
          <div class="character-avatar" 
               [ngClass]="(characters.find(c => c.id === player2Id)?.race.toLowerCase() || '') + '-' + 
                        (characters.find(c => c.id === player2Id)?.type || '')">
            <i class="fa" 
               [ngClass]="characters.find(c => c.id === player2Id)?.type === 'warrior' ? 'fa-shield-alt' : 'fa-hat-wizard'"></i>
          </div>
          <h3>{{ getCharacterName(player2Id) }}</h3>
        </div>
        
        <div class="fighter fighter-placeholder" *ngIf="!player2Id">
          <div class="character-avatar-placeholder">
            <i class="fa fa-question"></i>
          </div>
          <h3>Select Fighter 2</h3>
        </div>
      </div>
      
      <div class="fight-actions">
        <button 
          (click)="startFight()" 
          class="btn btn-danger btn-lg"
          [disabled]="loading || !player1Id || !player2Id || player1Id === player2Id">
          <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
          Start Fight!
        </button>
      </div>
    </div>
  
    <div *ngIf="showResult && fightResult" class="fight-result">
      <h3>Battle Result</h3>
      
      <div class="result-header" [ngClass]="fightResult.winner === getCharacterName(player1Id!) ? 'victory-1' : 'victory-2'">
        <div class="result-title">
          {{ fightResult.winner }} Wins!
        </div>
      </div>
      
      <div class="combatants">
        <div class="fighter-info">
          <h4>{{ getCharacterName(player1Id!) }}</h4>
          <div class="health-display">
            <div class="health-bar">
              <div class="health-fill fighter-1" 
                   [style.width.%]="(fightResult.rounds[fightResult.rounds.length-1].player1Health / fightResult.players!.player1.originalHealth) * 100">
              </div>
            </div>
            <span class="health-text">
              {{ fightResult.rounds[fightResult.rounds.length-1].player1Health }} / {{ fightResult.players!.player1.originalHealth }}
            </span>
          </div>
        </div>
        
        <div class="vs">VS</div>
        
        <div class="fighter-info">
          <h4>{{ getCharacterName(player2Id!) }}</h4>
          <div class="health-display">
            <div class="health-bar">
              <div class="health-fill fighter-2" 
                   [style.width.%]="(fightResult.rounds[fightResult.rounds.length-1].player2Health / fightResult.players!.player2.originalHealth) * 100">
              </div>
            </div>
            <span class="health-text">
              {{ fightResult.rounds[fightResult.rounds.length-1].player2Health }} / {{ fightResult.players!.player2.originalHealth }}
            </span>
          </div>
        </div>
      </div>
      
      <div class="battle-rounds">
        <h4>Battle Log</h4>
        <div class="rounds-container">
          <div *ngFor="let round of fightResult.rounds" class="round">
            <div class="round-header">Round {{ round.round }}</div>
            <div *ngIf="round.initiative" class="initiative">
              {{ round.initiative }} has the initiative
            </div>
            <div *ngIf="round.damageToPlayer1" class="damage player2-damage">
              {{ getCharacterName(player2Id!) }} deals {{ round.damageToPlayer1 }} damage to {{ getCharacterName(player1Id!) }}
            </div>
            <div *ngIf="round.damageToPlayer2" class="damage player1-damage">
              {{ getCharacterName(player1Id!) }} deals {{ round.damageToPlayer2 }} damage to {{ getCharacterName(player2Id!) }}
            </div>
            <div *ngIf="round.winner" class="round-winner">
              {{ round.winner }} wins the battle!
            </div>
          </div>
        </div>
      </div>
      
      <div class="result-actions">
        <button (click)="resetFight()" class="btn btn-primary">New Battle</button>
        <a routerLink="/character/profile" class="btn btn-secondary">Character Profile</a>
      </div>
    </div>
  </div>